<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class RubyProf::ProfileTask - ruby-prof</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/ruby-prof/task.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Rake::TestTask
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-clean_output_directory">#clean_output_directory</a>
    
    <li><a href="#method-i-create_output_directory">#create_output_directory</a>
    
    <li><a href="#method-i-define">#define</a>
    
    <li><a href="#method-i-output_directory">#output_directory</a>
    
    <li><a href="#method-i-run_script">#run_script</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="../LICENSE.html">LICENSE</a>
  
    <li class="file"><a href="../README_rdoc.html">README</a>
  
    <li class="file"><a href="../examples/flat_txt.html">flat</a>
  
    <li class="file"><a href="../examples/graph_txt.html">graph</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../RubyProf.html">RubyProf</a>
  
    <li><a href="../RubyProf/AbstractPrinter.html">RubyProf::AbstractPrinter</a>
  
    <li><a href="../RubyProf/AggregateCallInfo.html">RubyProf::AggregateCallInfo</a>
  
    <li><a href="../RubyProf/CallInfo.html">RubyProf::CallInfo</a>
  
    <li><a href="../RubyProf/CallInfoPrinter.html">RubyProf::CallInfoPrinter</a>
  
    <li><a href="../RubyProf/CallInfoVisitor.html">RubyProf::CallInfoVisitor</a>
  
    <li><a href="../RubyProf/CallStackPrinter.html">RubyProf::CallStackPrinter</a>
  
    <li><a href="../RubyProf/CallTreePrinter.html">RubyProf::CallTreePrinter</a>
  
    <li><a href="../RubyProf/Cmd.html">RubyProf::Cmd</a>
  
    <li><a href="../RubyProf/DotPrinter.html">RubyProf::DotPrinter</a>
  
    <li><a href="../RubyProf/FlatPrinter.html">RubyProf::FlatPrinter</a>
  
    <li><a href="../RubyProf/FlatPrinterWithLineNumbers.html">RubyProf::FlatPrinterWithLineNumbers</a>
  
    <li><a href="../RubyProf/GraphHtmlPrinter.html">RubyProf::GraphHtmlPrinter</a>
  
    <li><a href="../RubyProf/GraphPrinter.html">RubyProf::GraphPrinter</a>
  
    <li><a href="../RubyProf/MethodInfo.html">RubyProf::MethodInfo</a>
  
    <li><a href="../RubyProf/MultiPrinter.html">RubyProf::MultiPrinter</a>
  
    <li><a href="../RubyProf/Profile.html">RubyProf::Profile</a>
  
    <li><a href="../RubyProf/ProfileTask.html">RubyProf::ProfileTask</a>
  
    <li><a href="../RubyProf/Test.html">RubyProf::Test</a>
  
    <li><a href="../RubyProf/Thread.html">RubyProf::Thread</a>
  
    <li><a href="../Rack.html">Rack</a>
  
    <li><a href="../Rack/RubyProf.html">Rack::RubyProf</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class RubyProf::ProfileTask</h1>

  <div id="description" class="description">
    
<p>Define a task library for profiling unit tests with ruby-prof.</p>

<p>All of the options provided by the Rake:TestTask are supported except the
loader which is set to ruby-prof.  For detailed information please refer to
the Rake:TestTask documentation.</p>

<p>ruby-prof specific options include:</p>

<pre>output_dir - For each file specified an output
             file with profile information will be
             written to the output directory.
             By default, the output directory is
             called &quot;profile&quot; and is created underneath
             the current working directory.

printer - Specifies the output printer.  Valid values include
          :flat, :graph, :graph_html and :call_tree.

min_percent - Methods that take less than the specified percent
              will not be written out.</pre>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">'ruby-prof/task'</span>

<span class="ruby-constant">RubyProf</span><span class="ruby-operator">::</span><span class="ruby-constant">ProfileTask</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-constant">FileList</span>[<span class="ruby-string">'test/test*.rb'</span>]
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">output_dir</span> = <span class="ruby-string">&quot;c:/temp&quot;</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">printer</span> = :<span class="ruby-identifier">graph</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">min_percent</span> = <span class="ruby-value">10</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If rake is invoked with a “TEST=filename” command line option, then the
list of test files will be overridden to include only the filename
specified on the command line.  This provides an easy way to run just one
test.</p>

<p>If rake is invoked with a “TESTOPTS=options” command line option, then the
given options are passed to the test process after a ‘–’.  This allows
Test::Unit options to be passed to the test suite.</p>

<p>Examples:</p>

<pre>rake profile                           # run tests normally
rake profile TEST=just_one_file.rb     # run just one test file.
rake profile TESTOPTS=&quot;-v&quot;             # run in verbose mode
rake profile TESTOPTS=&quot;--runner=fox&quot;   # use the fox test runner</pre>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-min_percent" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">min_percent</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-output_dir" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">output_dir</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-printer" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">printer</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(name = :profile)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/ruby-prof/task.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">name</span> = <span class="ruby-value">:profile</span>)
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">name</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-clean_output_directory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clean_output_directory</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="clean_output_directory-source">
            <pre><span class="ruby-comment"># File lib/ruby-prof/task.rb, line 134</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clean_output_directory</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">output_directory</span>)
    <span class="ruby-identifier">files</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">output_directory</span> <span class="ruby-operator">+</span> <span class="ruby-string">'/*'</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span>(<span class="ruby-identifier">files</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- clean_output_directory-source -->
          
        </div>

        

        
      </div><!-- clean_output_directory-method -->

    
      <div id="method-i-create_output_directory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_output_directory</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="create_output_directory-source">
            <pre><span class="ruby-comment"># File lib/ruby-prof/task.rb, line 128</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_output_directory</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">output_directory</span>)
    <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">output_directory</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- create_output_directory-source -->
          
        </div>

        

        
      </div><!-- create_output_directory-method -->

    
      <div id="method-i-define" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">define</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Create the tasks defined by this task lib.</p>
          

          
          <div class="method-source-code" id="define-source">
            <pre><span class="ruby-comment"># File lib/ruby-prof/task.rb, line 68</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">define</span>
  <span class="ruby-identifier">lib_path</span> = <span class="ruby-ivar">@libs</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>)
  <span class="ruby-identifier">desc</span> <span class="ruby-string">&quot;Profile&quot;</span> <span class="ruby-operator">+</span> (<span class="ruby-ivar">@name</span><span class="ruby-operator">==</span><span class="ruby-value">:profile</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot; for #{@name}&quot;</span>)

  <span class="ruby-identifier">task</span> <span class="ruby-ivar">@name</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">create_output_directory</span>

    <span class="ruby-ivar">@ruby_opts</span>.<span class="ruby-identifier">unshift</span>( <span class="ruby-node">&quot;-I#{lib_path}&quot;</span> )
    <span class="ruby-ivar">@ruby_opts</span>.<span class="ruby-identifier">unshift</span>( <span class="ruby-string">&quot;-w&quot;</span> ) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@warning</span>
    <span class="ruby-ivar">@ruby_opts</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&quot;-S ruby-prof&quot;</span>)
    <span class="ruby-ivar">@ruby_opts</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;--printer #{@printer}&quot;</span>)
    <span class="ruby-ivar">@ruby_opts</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;--min_percent #{@min_percent}&quot;</span>)

    <span class="ruby-identifier">file_list</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file_path</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">run_script</span>(<span class="ruby-identifier">file_path</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- define-source -->
          
        </div>

        

        
      </div><!-- define-method -->

    
      <div id="method-i-output_directory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output_directory</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="output_directory-source">
            <pre><span class="ruby-comment"># File lib/ruby-prof/task.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">output_directory</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-ivar">@output_dir</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- output_directory-source -->
          
        </div>

        

        
      </div><!-- output_directory-method -->

    
      <div id="method-i-run_script" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run_script</span><span
            class="method-args">(script_path)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Run script</p>
          

          
          <div class="method-source-code" id="run_script-source">
            <pre><span class="ruby-comment"># File lib/ruby-prof/task.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run_script</span>(<span class="ruby-identifier">script_path</span>)
  <span class="ruby-identifier">run_code</span> = <span class="ruby-string">''</span>
  <span class="ruby-constant">RakeFileUtils</span>.<span class="ruby-identifier">verbose</span>(<span class="ruby-ivar">@verbose</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">file_name</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">script_path</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">script_path</span>))
    <span class="ruby-keyword">case</span> <span class="ruby-ivar">@printer</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:flat</span>, <span class="ruby-value">:graph</span>, <span class="ruby-value">:call_tree</span>
        <span class="ruby-identifier">file_name</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;.txt&quot;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:graph_html</span>
        <span class="ruby-identifier">file_name</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;.html&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">file_name</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&quot;.txt&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">output_file_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">output_directory</span>, <span class="ruby-identifier">file_name</span>)

    <span class="ruby-identifier">command_line</span> = <span class="ruby-ivar">@ruby_opts</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>) <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot; --file=&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">output_file_path</span> <span class="ruby-operator">+</span>
                  <span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">script_path</span>

    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;ruby &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">command_line</span>
    <span class="ruby-comment"># We have to catch the exeption to continue on.  However,</span>
    <span class="ruby-comment"># the error message will have been output to STDERR</span>
    <span class="ruby-comment"># already by the time we get here so we don't have to</span>
    <span class="ruby-comment"># do that again</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">ruby</span> <span class="ruby-identifier">command_line</span>
    <span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-constant">STDOUT</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span>
      <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- run_script-source -->
          
        </div>

        

        
      </div><!-- run_script-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.1.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

